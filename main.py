import requests,re
import time
import random
from bs4 import BeautifulSoup
a=[11458,11460,11462,11463,11466,11481,11482,11483,11488,11495,11498,11504,11505,11508,11510,11517,11522,11524,11527,11528,11532,11535,11538,11540,11545,11546,11548,11551,11556,11557,11560,11600,11607,11629,11632,11641,11646,11647,11653,11654,11656,11658,11660,11664,11688,11726,11733,11736,11765,11775,11785,11796,11798,11799,11800,11802,11810,11819,11821,11823,11824,11825,11831,11832,11833,11834,11835,11837,11842,11843,11846,11903,11908,11916,11956,11959,11961,11964,11965,11967,11968,12026,12034,12036,12040,12044,12047,12048,12049,12050,12051,12052,12053,12054,12055,12056,12058,12059,12061,12062,12064,12070,12072,12078,12104,12106,12121,12219,12300,12301,12302,12303,12308,12309,12310,12317,12324,12328,12332,12336,12343,12347,12354,12362,12364,12369,12397,12401,12425,12440,12453,12484,12487,12493,12495,12497,12498,12499,12510,12544,12560,12564,12565,12566,12568,12576,12583,12584,12586,12587,12588,12596,12597,12599,12600,12601,12604,12605,12609,12616,12618,12631,12636,12645,12647,12649,12650,12651,12652,12657,12658,12660,12661,12662,12679,12682,12684,12687,12688,12689,12702,12703,12709,12710,12712,12713,12714,12715,12719,12720,12721,12722,12723,12727,12732,12733,12734,12735,12737,12738,12739,12740,12744,12747,12752,12758,12759,12761,12763,12764,12766,12768,12773,12776,12784,12786,12788,12789,12790,12791,12792,12795,12798,12800,12801,12802,12803,12804,12805,12806,12807,12808,12809,12816,12821,12830,12844,12851,12861,12862,12863,12864,12865,12866,12867,12868,12869,12870,12871,12872,12874,12875,12876,12877,12878,12882,12883,12895,12899,12901,12903,12907,12912,12913,12914,12915,12918,12919,12920,12921,12922,12923,12929,12930,12932,12933,12936,12938,12939,12940,12941,12942,12943,12944,12947,12952,12964,12969,12977,12978,12980,12982,12983,12984,12986,12988,12989,12990,12991,13001,13002,13003,13006,13010,13011,13014,13015,13017,13021,13022,13023,13025,13026,13027,13028,13029,13030,13031,13032,13043,13044,13045,13058,13059,13071,13074,13100,13101,13102,13103,13104,13105,13106,13107,13108,13110,13112,13113,13114,13121,13123,13125,13177,13188,13198,13201,13207,13208,13212,13218,13220,13234,13235,13236,13238,13239,13240,13241,13242,13245,13247,13248,13249,13250,13251,13262,13264,13265,13266,13275,13276,13277,13279,13280,13282,13283,13284,13285,13286,13287,13288,13289,13290,13291,13292,13294,13296,13298,13299,13300,13304,13307,13320,13321,13322,13324,13325,13326,13328,13330,13332,13336,13339,13340,13356,13378,13383,13386,13387,13389,13391,13392,13397,13402,13404,13414,13415,13417,13418,13419,13420,13421,13422,13423,13425,13429,13431,13432,13433,13434,13435,13436,13437,13438,13440,13441,13447,13448,13468,13469,13470,13471,13472,13499,13500,13501,13507,13508,13511,13514,13515,13524,13534,13535,13538,13548,13558,13560,13561,13569,13571,13575,13576,13577,13578,13584,13588,13590,13592,13593,13596,13599,13600,13601,13602,13603,13604,13605,13606,13607,13609,13611,13612,13614,13615,13617,13618,13619,13622,13623,13625,13626,13627,13629,13630,13631,13632,13635,13636,13637,13638,13639,13640,13641,13643,13644,13645,13646,13648,13649,13654,13655,13657,13658,13660,13661,13662,13663,13664,13665,13666,13668,13669,13670,13671,13672,13673,13675,13677,13678,13679,13680,13681,13682,13684,13686,13688,13700,13702,13703,13705,13706,13714,13728,13730,13738,13739,13742,13746,13747,13748,13749,13750,13751,13753,13754,13762,13766,13773,13774,13775,13776,13780,13782,13785,13787,13791,13796,13798,13799,13800,13801,13802,13811,13819,13829,13830,13831,13836,13842,13843,13844,13845,13846,13849,13853,13854,13863,13867,13869,13870,13871,13872,13873,13875,13891,13892,13893,13894,13895,13896,13897,13898,13899,13900,13901,13903,13904,13905,13906,13917,13921,13924,13931,13938,13939,13940,13941,13942,13943,13945,13948,13962,13963,13964,13967,13979,13980,13982,13983,13984,13985,13986,13987,13988,13989,13990,13991,13993,13994,13995,13997,13998,13999,14002,14008,14009,14018,14021,14022,14025,14026,14034,14035,14037,14038,14039,14041,14042,14043,14046,14052,14056,14061,14080,14086,14087,14088,14089,14090,14099,14101,14127,14138,14139,14163,14167,14168,14170,14177,14178,14180,14190,14201,14202,14206,14207,14211,14213,14223,14250,14256,14269,14275,14293,14295,14296,14300,14309,14312,14322,14325,14327,14329,14353,14357,14358,14359,14360,14366,14389,14394,14406,14410,14422,14423,14425,14430,14431,14432,14434,14440,14465,14467,14472,14475,14476,14481,14492,14494,14504,14506,14508,14515,14528,14535,14537,14541,14542,14544,14553,14555,14560,14568,14571,14574,14575,14589,14590,14591,14599,14602,14604,14605,14606,14608,14612,15496,16301,16302,16401,16404,16405,16407,16408,16410,18127,19001,19002,19004,19013,19141,19145,19213,19246,19248,19335,19359,19414,19422,19614,50084,50559,50870,51721,81002,81006,91002,91002,91004,91004,91005,91005,91006,91006,91007,91007,91009,91009,91010,91010,91011,91011,91012,91012,91013,91013,91014,91014,91016,91016,91017,91017,91018,91018,91019,91019,91020,91020,91024,91024,91025,91025,91026,91026,91030,91030,91034,91034,91036,91036,91037,91037,91039,91039,91040,91040,91041,91041]
path="d://programing//PY//crawlerdata//"
head={'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36'}
def getHTMLText(url):
	try:
		r=requests.get(url,headers=head,timeout=30)
		r.raise_for_status()	#如果状态码不是200，产生异常
		r.encoding='utf-8-sig'		#字符编码格式改成 utf-8
		return r.text
	except:
		#异常处理
		return "get html text error"

def single(url,inde):
	try:
		# print(url)
		htmltext=getHTMLText(url)
	except:
		throw("Nothing here!")


	try:
		soup=BeautifulSoup(htmltext,"html.parser")
		#con=soup.find_all('',class_="")
		#for i in range(len(con)):
		#	print(con[i].text)
		

	except:
		print("Failed soup")
	
	try:
		htm=open(path+"htmdata//"+"htmdata"+str(inde)+".txt",'w+')
		htm.write(str(soup))
		htm.close()
		print("Got it!")
	except Exception as e:
		print(str(e))



#main part
log=open(path+"log.txt",'w+')
for i in range(len(a)):
#ranges=itertools.chain(xrange(10001,10734),xrange())
# for i in ranges:
	try:
		print(a[i])
		single("http://zt.zjzs.net/xk2020/"+str(a[i])+".html",a[i])
		time.sleep(random.randint(5,7))
		log.write("http://zt.zjzs.net/xk2020/"+str(a[i])+".html\n")
	except:
		log.write("There's nothing in",i)
		time.sleep(random.randint(2,4))
log.close()